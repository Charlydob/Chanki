<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>CHANKI</title>
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="stylesheet" href="./css/base.css" />
    <link rel="stylesheet" href="./css/folders.css" />
    <link rel="stylesheet" href="./css/review.css" />
    <link rel="stylesheet" href="./css/stats.css" />
  </head>
  <body>
    <div id="app" class="app">
      <header class="app__header">
        <div class="brand">
          <span class="brand__dot"></span>
          <h1>CHANKI</h1>
        </div>
        <div id="status" class="status"></div>
      </header>

      <main class="app__main">
        <section id="screen-folders" class="screen active">
          <div class="screen__header">
            <h2>Carpetas</h2>
            <button id="add-folder" class="button">Nueva carpeta</button>
          </div>
          <div id="folder-tree" class="list"></div>
          <div class="screen__header">
            <h3 id="cards-title">Tarjetas</h3>
            <button id="add-card" class="button">Nueva tarjeta</button>
          </div>
          <div class="cards-search">
            <input id="cards-search-input" type="text" placeholder="Buscar tarjetas…" />
            <button
              id="cards-search-clear"
              class="icon-button icon-button--compact cards-search__clear hidden"
              type="button"
              aria-label="Limpiar búsqueda"
            >
              ✕
            </button>
          </div>
          <div class="cards-meta">
            <span id="cards-dup-count" class="cards-meta__count">Duplicadas: 0</span>
            <button id="cards-dup-toggle" class="button ghost small" type="button">
              Mostrar solo duplicadas
            </button>
          </div>
          <div id="cards-list" class="list"></div>
          <button id="load-more" class="button ghost">Cargar más</button>
        </section>

        <section id="screen-review" class="screen">
          <div id="screen-review-config" class="review-screen">
            <div class="screen__header">
              <h2>Repasar</h2>
            </div>
            <div class="card settings-block">
              <div class="bucket-filter">
                <p class="eyebrow">Buckets</p>
                <div id="review-bucket-chart" class="bucket-chart">
                  <button class="bucket-bar active" data-bucket="new" type="button">
                    <span class="bucket-bar__bar">
                      <span class="bucket-bar__fill"></span>
                    </span>
                    <span class="bucket-bar__meta">
                      <span class="bucket-bar__value" data-bucket-count="new">0</span>
                      <span class="bucket-bar__label">Nvo</span>
                    </span>
                  </button>
                  <button class="bucket-bar active" data-bucket="immediate" type="button">
                    <span class="bucket-bar__bar">
                      <span class="bucket-bar__fill"></span>
                    </span>
                    <span class="bucket-bar__meta">
                      <span class="bucket-bar__value" data-bucket-count="immediate">0</span>
                      <span class="bucket-bar__label">Ahora</span>
                    </span>
                  </button>
                  <button class="bucket-bar active" data-bucket="lt24h" type="button">
                    <span class="bucket-bar__bar">
                      <span class="bucket-bar__fill"></span>
                    </span>
                    <span class="bucket-bar__meta">
                      <span class="bucket-bar__value" data-bucket-count="lt24h">0</span>
                      <span class="bucket-bar__label">&lt;24h</span>
                    </span>
                  </button>
                  <button class="bucket-bar active" data-bucket="tomorrow" type="button">
                    <span class="bucket-bar__bar">
                      <span class="bucket-bar__fill"></span>
                    </span>
                    <span class="bucket-bar__meta">
                      <span class="bucket-bar__value" data-bucket-count="tomorrow">0</span>
                      <span class="bucket-bar__label">Mañana</span>
                    </span>
                  </button>
                  <button class="bucket-bar active" data-bucket="week" type="button">
                    <span class="bucket-bar__bar">
                      <span class="bucket-bar__fill"></span>
                    </span>
                    <span class="bucket-bar__meta">
                      <span class="bucket-bar__value" data-bucket-count="week">0</span>
                      <span class="bucket-bar__label">&lt;1sem</span>
                    </span>
                  </button>
                  <button class="bucket-bar active" data-bucket="future" type="button">
                    <span class="bucket-bar__bar">
                      <span class="bucket-bar__fill"></span>
                    </span>
                    <span class="bucket-bar__meta">
                      <span class="bucket-bar__value" data-bucket-count="future">0</span>
                      <span class="bucket-bar__label">Futuro</span>
                    </span>
                  </button>
                </div>
              </div>
              <label class="field">
                <span>Carpeta</span>
                <select id="review-folder"></select>
              </label>
              <label class="field">
                <span>Tags (separados por coma)</span>
                <input id="review-tags" type="text" placeholder="a1, verbos" />
              </label>
              <div class="row">
                <label class="field">
                  <span>Max nuevas</span>
                  <input id="review-max-new" type="number" min="0" value="10" />
                </label>
                <label class="field">
                  <span>Max repasar</span>
                  <input id="review-max" type="number" min="0" value="50" />
                </label>
              </div>
              <button id="start-review" class="button">Empezar</button>
            </div>
          </div>
          <div id="screen-review-player" class="review-player screen-review-player hidden">
            <div class="player-inner">
              <div class="review-player__header">
                <button id="review-exit" class="icon-button" type="button" aria-label="Volver">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path
                      d="M15.5 5.5 9 12l6.5 6.5"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
                <div class="review-player__title">
                  <span id="review-player-folder">Todas</span>
                  <span id="review-player-counter">0/0</span>
                </div>
                <div class="review-player__actions">
                  <button id="review-edit-card" class="icon-button" type="button" aria-label="Editar tarjeta">
                    ✏️
                  </button>
                  <span id="review-player-bucket" class="chip hidden">Nvo</span>
                </div>
              </div>
              <div class="review-player__body">
                <div id="review-card" class="review-card review-card--large"></div>
                <button id="flip-card" class="button ghost">Mostrar respuesta</button>
                <div class="review-actions hidden" id="review-actions">
                  <button data-rating="error" class="button danger">Error</button>
                  <button data-rating="bad" class="button warning">Malo</button>
                  <button data-rating="good" class="button">Bueno</button>
                  <button data-rating="easy" class="button success">Fácil</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="screen-import" class="screen">
          <div class="screen__header">
            <h2>Importar</h2>
          </div>
          <textarea id="import-text" rows="10" placeholder="Pega aquí tu contenido"></textarea>
          <div id="import-preview" class="card"></div>
          <button id="import-parse" class="button" type="button">Previsualizar</button>
          <button id="import-save" class="button" type="button">Guardar en RTDB</button>
        </section>

        <section id="screen-stats" class="screen">
          <div class="screen__header">
            <h2>Estadísticas</h2>
          </div>
          <div class="stats-stack">
            <div class="card stats-card">
              <h3>Hoy</h3>
              <div class="stats-highlight" id="stats-today-count">0 repasos</div>
              <div class="stats-row">
                <div>
                  <p class="muted">Minutos</p>
                  <p id="stats-today-minutes">0</p>
                </div>
                <div>
                  <p class="muted">Acierto</p>
                  <p id="stats-today-accuracy">0%</p>
                </div>
              </div>
              <div class="stats-chip-row" id="stats-today-distribution"></div>
            </div>
            <div class="card stats-card">
              <h3>Semana</h3>
              <div class="stats-row">
                <div>
                  <p class="muted">Total</p>
                  <p id="stats-week-total">0</p>
                </div>
                <div>
                  <p class="muted">Minutos</p>
                  <p id="stats-week-minutes">0</p>
                </div>
                <div>
                  <p class="muted">Media/día</p>
                  <p id="stats-week-average">0</p>
                </div>
              </div>
              <canvas id="stats-week-chart" class="mini-chart" width="320" height="120"></canvas>
            </div>
            <div class="card stats-card">
              <h3>Mes</h3>
              <div class="stats-row">
                <div>
                  <p class="muted">Total</p>
                  <p id="stats-month-total">0</p>
                </div>
                <div>
                  <p class="muted">Media/día</p>
                  <p id="stats-month-average">0</p>
                </div>
                <div>
                  <p class="muted">Mejor día</p>
                  <p id="stats-month-best">-</p>
                </div>
              </div>
              <p id="stats-month-compare" class="muted stats-compare">-</p>
            </div>
            <div class="card stats-card">
              <h3>Calendario</h3>
              <div class="stats-heatmap" id="stats-heatmap"></div>
              <div id="stats-heatmap-tooltip" class="stats-heatmap__tooltip hidden"></div>
            </div>
            <div class="card stats-card">
              <h3>Últimos 30 días</h3>
              <canvas id="stats-month-chart" class="mini-chart" width="320" height="140"></canvas>
            </div>
            <div class="card stats-card">
              <h3>Distribución del mes</h3>
              <div class="stats-donut">
                <canvas id="stats-month-donut" width="220" height="220"></canvas>
                <div id="stats-month-legend" class="stats-donut__legend"></div>
              </div>
            </div>
            <div class="card stats-card">
              <h3>Racha</h3>
              <div class="stats-row">
                <div>
                  <p class="muted">Actual</p>
                  <p id="stats-streak-current">0 días</p>
                </div>
                <div>
                  <p class="muted">Mejor</p>
                  <p id="stats-streak-best">0 días</p>
                </div>
              </div>
            </div>
            <div class="card stats-card">
              <h3>Totales</h3>
              <div class="stats-row">
                <div>
                  <p class="muted">Tarjetas</p>
                  <p id="stats-total-cards">0</p>
                </div>
                <div>
                  <p class="muted">Nuevas</p>
                  <p id="stats-total-new">0</p>
                </div>
                <div>
                  <p class="muted">No nuevas</p>
                  <p id="stats-total-learned">0</p>
                </div>
              </div>
              <div id="stats-bucket-counts" class="bucket-counts"></div>
            </div>
          </div>
        </section>

        <section id="screen-settings" class="screen">
          <div class="screen__header">
            <h2>Ajustes</h2>
          </div>
          <div class="settings-stack">
            <div class="card settings-block">
              <div class="section-header">
                <h3>Identidad</h3>
                <p class="muted">Cambiar el username apunta a otra raíz de datos.</p>
              </div>
              <label class="field">
                <span>Nombre de usuario</span>
                <input id="settings-username" type="text" />
              </label>
            </div>
            <div class="card settings-block">
              <div class="section-header">
                <h3>Sesiones por defecto</h3>
                <p class="muted">Controla la carga máxima por sesión.</p>
              </div>
              <div class="row">
                <label class="field">
                  <span>Max nuevas</span>
                  <input id="settings-max-new" type="number" min="0" />
                </label>
                <label class="field">
                  <span>Max repasar</span>
                  <input id="settings-max" type="number" min="0" />
                </label>
              </div>
              <button id="save-settings" class="button">Guardar ajustes</button>
            </div>
            <div class="card settings-block">
              <div class="section-header">
                <h3>Cloze</h3>
                <p class="muted">Controla la comparación de respuestas en cloze.</p>
              </div>
              <label class="field field-inline">
                <span>Comparar sin mayúsculas (recomendado para alemán)</span>
                <input id="settings-cloze-case" type="checkbox" />
              </label>
            </div>
            <div class="card settings-block">
              <div class="section-header">
                <h3>Datos</h3>
                <p class="muted">Exporta tu contenido o limpia ajustes locales.</p>
              </div>
              <button id="export-json" class="button ghost">Exportar JSON</button>
              <button id="reset-local" class="button danger">Reset localStorage</button>
            </div>
          </div>
        </section>
      </main>

      <nav class="tabs">
        <button class="tab active" data-screen="folders">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M4 6.5A2.5 2.5 0 0 1 6.5 4H10l2 2h5.5A2.5 2.5 0 0 1 20 8.5v9A2.5 2.5 0 0 1 17.5 20h-11A2.5 2.5 0 0 1 4 17.5z"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            />
          </svg>
          <span>Carpetas</span>
        </button>
        <button class="tab" data-screen="review">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M4 12.5c2.5-3 5.5-4.5 8-4.5 2.5 0 5.5 1.5 8 4.5-2.5 3-5.5 4.5-8 4.5s-5.5-1.5-8-4.5Z"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            />
            <circle cx="12" cy="12.5" r="2.2" fill="currentColor" />
          </svg>
          <span>Repasar</span>
        </button>
        <button class="tab" data-screen="import">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M12 4v10m0 0-3-3m3 3 3-3M5 18h14"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <span>Importar</span>
        </button>
        <button class="tab" data-screen="stats">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M4 18V6m5 12V10m5 8V8m5 10v-4"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            />
          </svg>
          <span>Stats</span>
        </button>
        <button class="tab" data-screen="settings">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M12 7.5a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9Zm7 4.5-1.6.9.1 1.8-1.5.9-1.4-1.1-1.7.6-.5 1.7H10l-.5-1.7-1.7-.6-1.4 1.1-1.5-.9.1-1.8L5 12l-1.6-.9.7-1.6-.7-1.6L5 7l.1-1.8 1.5-.9 1.4 1.1 1.7-.6.5-1.7h1.9l.5 1.7 1.7.6 1.4-1.1 1.5.9-.1 1.8 1.6.9-.7 1.6Z"
              fill="none"
              stroke="currentColor"
              stroke-width="1.2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <span>Ajustes</span>
        </button>
      </nav>
    </div>

    <div id="overlay" class="overlay hidden">
      <div class="modal">
        <h2>Bienvenido a CHANKI</h2>
        <label class="field">
          <span>Nombre de usuario</span>
          <input id="username-input" type="text" placeholder="tu nombre" />
        </label>
        <button id="save-username" class="button" type="button">Entrar</button>
      </div>
    </div>

    <div id="card-modal" class="overlay hidden">
      <div class="modal">
        <h2 id="card-modal-title">Nueva tarjeta</h2>
        <label class="field">
          <span>Tipo</span>
          <select id="card-type">
            <option value="basic">Basic</option>
            <option value="cloze">Cloze</option>
          </select>
        </label>
        <label class="field" id="card-basic-front-field">
          <span>Frente</span>
          <textarea id="card-front" rows="3"></textarea>
        </label>
        <label class="field" id="card-basic-back-field">
          <span>Reverso</span>
          <textarea id="card-back" rows="3"></textarea>
        </label>
        <label class="field hidden" id="card-cloze-text-field">
          <span>Texto cloze (usa ____ para el hueco)</span>
          <textarea id="card-cloze-text" rows="3"></textarea>
        </label>
        <label class="field hidden" id="card-cloze-answers-field">
          <span>Respuestas (separa con | )</span>
          <input id="card-cloze-answers" type="text" placeholder="antwort | Antwort2" />
        </label>
        <label class="field">
          <span>Tags (coma)</span>
          <input id="card-tags" type="text" />
        </label>
        <div class="row">
          <button id="save-card" class="button" type="button">Guardar</button>
          <button id="cancel-card" class="button ghost" type="button">Cancelar</button>
        </div>
      </div>
    </div>

    <div id="folder-modal" class="overlay hidden">
      <div class="modal">
        <h2 id="folder-modal-title">Nueva carpeta</h2>
        <label class="field">
          <span>Nombre</span>
          <input id="folder-name-input" type="text" placeholder="Ej: Verbos" />
        </label>
        <div class="row">
          <button id="save-folder" class="button" type="button">Crear</button>
          <button id="cancel-folder" class="button ghost" type="button">Cancelar</button>
        </div>
      </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script type="module" src="./js/app.js"></script>
  </body>
</html>
